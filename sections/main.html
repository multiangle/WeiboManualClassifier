<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Manual Weibo Classifier</title>

    <link href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script>
        // window.$ = window.jQuery = require('../node_modules/jquery/dist/jquery.min.js');
        window.$ = window.jQuery = require('jquery') ;
        // require('../node_modules/bootstrap/dist/js/bootstrap.min.js');
        require('bootstrap');
        electron = require("electron") ;
        ipcr = electron.ipcRenderer ;
    </script>
    <style>
        label.cbtn {
            margin-left:5px
        }
    </style>
    <script>

        $("document").ready(function(){

            init() ; // 参数初始化

            $(".ebtn").click((e)=>{
                let btn = $(e.target) ;
                
                let btns = $(".ebtn").get() ;
                for(let i in btns){
                    $(btns[i]).removeClass('btn-primary').addClass('btn-default') ;
                }
                btn.removeClass('btn-default');
                btn.addClass('btn-primary') ;
                emotion_selected = btn.text() ;
                emotion_id = emotions.indexOf(emotion_selected) ;
                console.log(emotion_selected) ;
            });

            // commit info, and reset info
            $("button#commit").click(()=>{
                if (emotion_id == -1){
                    alert("Cannot COMMIT!") ;
                    return ;
                }
                
                // 摘录信息
                let res = {};
                res.emotion = emotion_selected ;
                res.id = emotion_id ;

                // 重置
                emotion_selected = "" ;
                emotion_id = -1 ;
                btns = $('.ebtn').get() ;
                for(let i in btns){
                    $(btns[i]).removeClass('btn-primary').addClass('btn-default') ;
                }

                // 提交后台
                ipcr.send('channel-commit',res) ;
                console.log(res) ;
            });
            
        })
        
        // hot key
        $(document).keydown((e)=>{
            let fmt = 'button#key-' ;
            let types = new Array('q','w','e','r','t') ;
            if (types.indexOf(e.key)>-1) { // 跟emotion有关的快捷键
                $(fmt+e.key).click()
                return ;
            }

            if (e.key == 'Enter'|| e.key==' ') $('button#commit').click() ;
            console.log(e.key) ;

            
        });

        function init(){
            emotion_selected = "" ;     // btn-group选中的情绪
            emotion_id = -1 ;
            emotions = new Array() ;    // 情绪列表
            emotion_num = 0 ;           // 情绪种类数目
            let ebtns = $(".ebtn").get() ;
            for(let i in ebtns){
                let btn = $(ebtns[i]) ;
                emotions.push(btn.text()) ;
                emotion_num++ ;
            }
            console.log(emotions) ;
        }
        
    </script>
</head>

<body>
    <div class="container">
        <div class="row clearfix" id="mainContent" style="margin-top:20px">
            <div class="jumbotron">
                <!--<h1>我的第一个 Bootstrap 页面</h1>-->
                <p>Microblog Content Here</p>
            </div>
        </div>
        <div class="row clearfix">
            <div class="col-sm-4">
                <h2>Emotion</h2>
                <div class="btn-group" id="emotion">
                    <button class="btn btn-default ebtn" type="button" id='key-q'>快乐</button>
                    <button class="btn btn-default ebtn" type="button" id='key-w'>愤怒</button>
                    <button class="btn btn-default ebtn" type="button" id='key-e'>恐惧</button>
                    <button class="btn btn-default ebtn" type="button" id='key-r'>哀伤</button>
                    <button class="btn btn-default ebtn" type="button" id='key-t'>中立</button>
                </div>
            </div>
            <div class="col-sm-7">
                <h2>Category</h2>
                <div class="btn-group" id="category">
                    
                    <button class="btn btn-default ebtn" type="button" id='key-y'>快乐</button>
                    <button class="btn btn-default ebtn" type="button" id='key-w'>愤怒</button>
                    <button class="btn btn-default ebtn" type="button" id='key-e'>恐惧</button>
                    <button class="btn btn-default ebtn" type="button" id='key-r'>哀伤</button>
                    <button class="btn btn-default ebtn" type="button" id='key-t'>中立</button>
                    <br>
                    <button class="btn btn-default ebtn" type="button" id='key-q'>快乐</button>
                    <button class="btn btn-default ebtn" type="button" id='key-w'>愤怒</button>
                    <button class="btn btn-default ebtn" type="button" id='key-e'>恐惧</button>
                    <button class="btn btn-default ebtn" type="button" id='key-r'>哀伤</button>
                    <button class="btn btn-default ebtn" type="button" id='key-t'>中立</button>
                </div>
            </div>
        </div>
        <div class="row clearfix" id="commit_div" style="margin-top:20px">
            <div class="col-sm-4">
                <!--btn是一个带有圆角的按钮样式，而btn-primary是一个淡蓝色的按钮样式，两者一起，就是淡蓝色的圆角按钮-->
                <button type="button" class="btn btn-primary" id="commit">COMMIT</button>
            </div>
        </div>
    </div>
</body>

</html>